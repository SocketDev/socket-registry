name: 'Setup Debug'
description: 'Parse and setup debug environment variables'

inputs:
  debug:
    description: 'Debug input - accepts "0", "1", or DEBUG="..." format'
    required: false
    default: '0'

outputs:
  socket_debug:
    description: 'The processed SOCKET_DEBUG value'
    value: ${{ steps.parse.outputs.socket_debug }}
  debug_value:
    description: 'The processed DEBUG value'
    value: ${{ steps.parse.outputs.debug_value }}

runs:
  using: 'composite'
  steps:
    - name: Parse debug input
      id: parse
      shell: bash
      env:
        DEBUG_INPUT: ${{ inputs.debug }}
      run: | # zizmor: ignore[github-env]
        # Check if input is in DEBUG='...' format
        if [[ "$DEBUG_INPUT" =~ ^DEBUG=[\'\"]*(.+)[\'\"]*$ ]]; then
          debug_value="${BASH_REMATCH[1]}"
          {
            echo "socket_debug=$debug_value"
            echo "debug_value=$debug_value"
          } >> "$GITHUB_OUTPUT"
          {
            echo "DEBUG=$debug_value"
            echo "SOCKET_DEBUG=$debug_value"
          } >> "$GITHUB_ENV"
        # Check if it's just a simple value (0, 1, or debug string)
        else
          {
            echo "socket_debug=$DEBUG_INPUT"
            echo "debug_value=$DEBUG_INPUT"
          } >> "$GITHUB_OUTPUT"
          echo "SOCKET_DEBUG=$DEBUG_INPUT" >> "$GITHUB_ENV"
          if [[ "$DEBUG_INPUT" != "0" ]]; then
            echo "DEBUG=$DEBUG_INPUT" >> "$GITHUB_ENV"
          fi
        fi
