name: âš¡ Lint

# Dependencies:
#   - SocketDev/socket-registry/.github/actions/setup-and-install@main
#   - SocketDev/socket-registry/.github/actions/run-script@main
#   - SocketDev/socket-registry/.github/actions/artifacts@main

on:
  workflow_call:
    inputs:
      continue-on-error:
        description: 'Continue workflow even if linting fails (e.g., true for warnings-only mode)'
        required: false
        type: boolean
        default: false
      debug:
        description: 'Enable debug output (e.g., "1" for verbose logging)'
        required: false
        type: string
        default: '0'
      lint-script:
        description: 'Lint command to run (e.g., "npm run lint", "pnpm run check")'
        required: false
        type: string
        default: 'pnpm run lint-ci'
      node-version:
        description: 'Node.js version to use for linting (e.g., "20", "22", "24")'
        required: false
        type: string
        default: '22'
      os:
        description: 'Operating system to run on (e.g., "ubuntu-latest", "windows-latest")'
        required: false
        type: string
        default: 'ubuntu-latest'
      retention-days:
        description: 'Days to retain artifacts (e.g., 7 for one week, 30 for one month)'
        required: false
        type: number
        default: 7
      setup-script:
        description: 'Setup script before linting (e.g., "npm run build")'
        required: false
        type: string
        default: ''
      timeout-minutes:
        description: 'Job timeout in minutes (e.g., 15 for extensive linting)'
        required: false
        type: number
        default: 10
      upload-artifacts:
        description: 'Upload lint results as artifacts (e.g., true for lint reports)'
        required: false
        type: boolean
        default: false
      working-directory:
        description: 'Working directory (e.g., "packages/core" for monorepos)'
        required: false
        type: string
        default: '.'

permissions:
  contents: read

jobs:
  lint-check:
    name: Run Lint Check
    runs-on: ${{ inputs.os }}
    timeout-minutes: ${{ inputs.timeout-minutes }}
    continue-on-error: ${{ inputs.continue-on-error }}
    steps:
      - uses: SocketDev/socket-registry/.github/actions/setup-and-install@main
        with:
          debug: ${{ inputs.debug }}
          node-version: ${{ inputs.node-version }}
          working-directory: ${{ inputs.working-directory }}

      - uses: SocketDev/socket-registry/.github/actions/run-script@main
        with:
          continue-on-error: ${{ inputs.continue-on-error }}
          main-script: ${{ inputs.lint-script }}
          setup-script: ${{ inputs.setup-script }}
          working-directory: ${{ inputs.working-directory }}

      - uses: SocketDev/socket-registry/.github/actions/artifacts@main
        if: inputs.upload-artifacts
        with:
          name: lint-results-${{ inputs.os }}-node-${{ inputs.node-version }}
          type: lint
          working-directory: ${{ inputs.working-directory }}
          retention-days: ${{ inputs.retention-days }}
