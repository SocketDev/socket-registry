name: âš¡ Type Check

# Dependencies:
#   - SocketDev/socket-registry/.github/actions/setup-and-install
#   - SocketDev/socket-registry/.github/actions/run-script
#   - SocketDev/socket-registry/.github/actions/artifacts

on:
  workflow_call:
    inputs:
      continue-on-error:
        description: 'Continue workflow even if type checking fails'
        required: false
        type: boolean
        default: false
      debug:
        description: 'Enable debug output (e.g., "1" for verbose logging)'
        required: false
        type: string
        default: '0'
      node-version:
        description: 'Node.js version to use (e.g., "20", "22", "24")'
        required: false
        type: string
        default: '22'
      os:
        description: 'Operating system to run on (e.g., "ubuntu-latest")'
        required: false
        type: string
        default: 'ubuntu-latest'
      retention-days:
        description: 'Days to retain artifacts (e.g., 7 for one week)'
        required: false
        type: number
        default: 7
      setup-script:
        description: 'Setup script before type checking (e.g., "npm run build")'
        required: false
        type: string
        default: ''
      timeout-minutes:
        description: 'Job timeout in minutes (e.g., 15 for complex types)'
        required: false
        type: number
        default: 10
      type-script:
        description: 'Type check command (e.g., "tsc --noEmit", "pnpm run check:tsc")'
        required: false
        type: string
        default: 'pnpm run check:tsc'
      upload-artifacts:
        description: 'Upload type check results as artifacts'
        required: false
        type: boolean
        default: false
      working-directory:
        description: 'Working directory (e.g., "packages/core" for monorepos)'
        required: false
        type: string
        default: '.'

permissions:
  contents: read

jobs:
  type-check:
    name: Run Type Check
    runs-on: ${{ inputs.os }}
    timeout-minutes: ${{ inputs.timeout-minutes }}
    continue-on-error: ${{ inputs.continue-on-error }}
    steps:
      - uses: SocketDev/socket-registry/.github/actions/setup-and-install@d1bbbbad7d1b29b8b36dc5871bd7f71df6b51ac4 # main
        with:
          debug: ${{ inputs.debug }}
          node-version: ${{ inputs.node-version }}
          working-directory: ${{ inputs.working-directory }}

      - uses: SocketDev/socket-registry/.github/actions/run-script@d1bbbbad7d1b29b8b36dc5871bd7f71df6b51ac4 # main
        with:
          continue-on-error: ${{ inputs.continue-on-error }}
          main-script: ${{ inputs.type-script }}
          setup-script: ${{ inputs.setup-script }}
          working-directory: ${{ inputs.working-directory }}

      - uses: SocketDev/socket-registry/.github/actions/artifacts@d1bbbbad7d1b29b8b36dc5871bd7f71df6b51ac4 # main
        if: inputs.upload-artifacts
        with:
          name: type-check-${{ inputs.os }}-node-${{ inputs.node-version }}
          type: test
          working-directory: ${{ inputs.working-directory }}
          retention-days: ${{ inputs.retention-days }}
